-- üíé Moji Hub - Fixed Shadow UI
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- Remove existing GUI
if PlayerGui:FindFirstChild("MojiHubUI") then
    PlayerGui:FindFirstChild("MojiHubUI"):Destroy()
end

-- Create main ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MojiHubUI"
screenGui.Parent = PlayerGui
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.DisplayOrder = 999

-- Main Frame (‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏™‡πà‡∏ß‡∏ô)
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 280, 0, 120)
mainFrame.Position = UDim2.new(0.5, -140, 0.15, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 15, 45)
mainFrame.BackgroundTransparency = 0.1
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

-- Shadow Frame (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏•‡πâ‡∏ô)
local shadowFrame = Instance.new("Frame")
shadowFrame.Name = "ShadowFrame"
shadowFrame.Size = UDim2.new(0, 280, 0, 120)
shadowFrame.Position = UDim2.new(0.5, -139, 0.15, 1)
shadowFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
shadowFrame.BackgroundTransparency = 0.85
shadowFrame.BorderSizePixel = 0
shadowFrame.ZIndex = mainFrame.ZIndex - 1
shadowFrame.Parent = screenGui

local shadowCorner = Instance.new("UICorner")
shadowCorner.CornerRadius = UDim.new(0, 12)
shadowCorner.Parent = shadowFrame

-- Main Frame Corner
local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 12)
mainCorner.Parent = mainFrame

-- Gradient Background
local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0.0, Color3.fromRGB(45, 25, 75)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(35, 20, 60)),
    ColorSequenceKeypoint.new(1.0, Color3.fromRGB(25, 15, 45))
}
gradient.Rotation = 135
gradient.Parent = mainFrame

-- Border Effect
local border = Instance.new("UIStroke")
border.Color = Color3.fromRGB(120, 80, 160)
border.Thickness = 1
border.Transparency = 0.4
border.Parent = mainFrame

-- Title Bar (‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏™‡πà‡∏ß‡∏ô)
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 35)
titleBar.Position = UDim2.new(0, 0, 0, 0)
titleBar.BackgroundColor3 = Color3.fromRGB(40, 25, 65)
titleBar.BackgroundTransparency = 0.2
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 12)
titleCorner.Parent = titleBar

-- Fix title bar bottom corners
local titleFix = Instance.new("Frame")
titleFix.Size = UDim2.new(1, 0, 0, 12)
titleFix.Position = UDim2.new(0, 0, 1, -12)
titleFix.BackgroundColor3 = Color3.fromRGB(40, 25, 65)
titleFix.BackgroundTransparency = 0.2
titleFix.BorderSizePixel = 0
titleFix.Parent = titleBar

-- Title Text (‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î)
local titleText = Instance.new("TextLabel")
titleText.Size = UDim2.new(0, 90, 1, 0)
titleText.Position = UDim2.new(0, 15, 0, 0)
titleText.BackgroundTransparency = 1
titleText.Text = "MOJI HUB"
titleText.TextColor3 = Color3.fromRGB(255, 255, 255)
titleText.TextSize = 14
titleText.Font = Enum.Font.GothamBold
titleText.TextXAlignment = Enum.TextXAlignment.Left
titleText.Parent = titleBar

-- Subtitle (‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î)
local subtitleText = Instance.new("TextLabel")
subtitleText.Size = UDim2.new(0, 120, 0, 12)
subtitleText.Position = UDim2.new(0, 110, 0.5, -6)
subtitleText.BackgroundTransparency = 1
subtitleText.Text = "Diamond Collector"
subtitleText.TextColor3 = Color3.fromRGB(180, 140, 220)
subtitleText.TextSize = 10
subtitleText.Font = Enum.Font.Gotham
subtitleText.TextXAlignment = Enum.TextXAlignment.Left
subtitleText.Parent = titleBar

-- Status Indicator (‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î)
local statusIndicator = Instance.new("Frame")
statusIndicator.Size = UDim2.new(0, 10, 0, 10)
statusIndicator.Position = UDim2.new(1, -20, 0.5, -5)
statusIndicator.BackgroundColor3 = Color3.fromRGB(0, 255, 100)
statusIndicator.BorderSizePixel = 0
statusIndicator.Parent = titleBar

local indicatorCorner = Instance.new("UICorner")
indicatorCorner.CornerRadius = UDim.new(1, 0)
indicatorCorner.Parent = statusIndicator

-- Content Frame (‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á)
local contentFrame = Instance.new("Frame")
contentFrame.Size = UDim2.new(1, -20, 1, -45)
contentFrame.Position = UDim2.new(0, 10, 0, 40)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainFrame

-- Diamond Section (‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î)
local diamondSection = Instance.new("Frame")
diamondSection.Size = UDim2.new(0.48, 0, 1, 0)
diamondSection.Position = UDim2.new(0, 0, 0, 0)
diamondSection.BackgroundColor3 = Color3.fromRGB(15, 10, 30)
diamondSection.BackgroundTransparency = 0.3
diamondSection.BorderSizePixel = 0
diamondSection.Parent = contentFrame

local diamondCorner = Instance.new("UICorner")
diamondCorner.CornerRadius = UDim.new(0, 8)
diamondCorner.Parent = diamondSection

local diamondBorder = Instance.new("UIStroke")
diamondBorder.Color = Color3.fromRGB(80, 60, 120)
diamondBorder.Thickness = 0.8
diamondBorder.Transparency = 0.4
diamondBorder.Parent = diamondSection

-- Diamond Count (‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á)
local diamondCount = Instance.new("TextLabel")
diamondCount.Size = UDim2.new(1, -12, 0, 22)
diamondCount.Position = UDim2.new(0, 6, 0, 8)
diamondCount.BackgroundTransparency = 1
diamondCount.Text = "0"
diamondCount.TextColor3 = Color3.fromRGB(255, 255, 255)
diamondCount.TextSize = 18
diamondCount.Font = Enum.Font.GothamBold
diamondCount.TextXAlignment = Enum.TextXAlignment.Center
diamondCount.Parent = diamondSection

-- Diamond Label (‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á)
local diamondLabel = Instance.new("TextLabel")
diamondLabel.Size = UDim2.new(1, -12, 0, 14)
diamondLabel.Position = UDim2.new(0, 6, 0, 35)
diamondLabel.BackgroundTransparency = 1
diamondLabel.Text = "DIAMONDS"
diamondLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
diamondLabel.TextSize = 9
diamondLabel.Font = Enum.Font.Gotham
diamondLabel.TextXAlignment = Enum.TextXAlignment.Center
diamondLabel.Parent = diamondSection

-- Status Section (‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î)
local statusSection = Instance.new("Frame")
statusSection.Size = UDim2.new(0.48, 0, 1, 0)
statusSection.Position = UDim2.new(0.52, 0, 0, 0)
statusSection.BackgroundColor3 = Color3.fromRGB(15, 10, 30)
statusSection.BackgroundTransparency = 0.3
statusSection.BorderSizePixel = 0
statusSection.Parent = contentFrame

local statusCorner = Instance.new("UICorner")
statusCorner.CornerRadius = UDim.new(0, 8)
statusCorner.Parent = statusSection

local statusBorder = Instance.new("UIStroke")
statusBorder.Color = Color3.fromRGB(80, 60, 120)
statusBorder.Thickness = 0.8
statusBorder.Transparency = 0.4
statusBorder.Parent = statusSection

-- Status Text (‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á)
local statusText = Instance.new("TextLabel")
statusText.Size = UDim2.new(1, -12, 0, 18)
statusText.Position = UDim2.new(0, 6, 0, 6)
statusText.BackgroundTransparency = 1
statusText.Text = "READY"
statusText.TextColor3 = Color3.fromRGB(100, 255, 150)
statusText.TextSize = 14
statusText.Font = Enum.Font.GothamBold
statusText.TextXAlignment = Enum.TextXAlignment.Center
statusText.Parent = statusSection

-- Status Description (‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á)
local statusDesc = Instance.new("TextLabel")
statusDesc.Size = UDim2.new(1, -12, 0, 12)
statusDesc.Position = UDim2.new(0, 6, 0, 26)
statusDesc.BackgroundTransparency = 1
statusDesc.Text = "System initialized"
statusDesc.TextColor3 = Color3.fromRGB(150, 150, 150)
statusDesc.TextSize = 8
statusDesc.Font = Enum.Font.Gotham
statusDesc.TextXAlignment = Enum.TextXAlignment.Center
statusDesc.Parent = statusSection

-- Status Label (‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á)
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1, -12, 0, 14)
statusLabel.Position = UDim2.new(0, 6, 0, 40)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "CURRENT STATUS"
statusLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
statusLabel.TextSize = 9
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextXAlignment = Enum.TextXAlignment.Center
statusLabel.Parent = statusSection

-- Variables for control
local isVisible = true
local dragging = false
local dragStart = nil
local startPos = nil
local updateConnection = nil

-- Dragging functionality (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç shadow position)
local function updateInput(input)
    local delta = input.Position - dragStart
    local newPosition = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    mainFrame.Position = newPosition
    shadowFrame.Position = UDim2.new(newPosition.X.Scale, newPosition.X.Offset + 1, newPosition.Y.Scale, newPosition.Y.Offset + 1)
end

titleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        updateInput(input)
    end
end)

-- Update diamond count function
local function updateDiamondCount()
    pcall(function()
        local diamonds = LocalPlayer:GetAttribute("Diamonds") or 0
        diamondCount.Text = tostring(diamonds)
    end)
end

-- Status animation
local function animateStatusIndicator(active)
    if active then
        local pulseTween = TweenService:Create(statusIndicator,
            TweenInfo.new(0.8, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true),
            {BackgroundTransparency = 0.5}
        )
        pulseTween:Play()
        
        -- Store tween for cleanup
        statusIndicator:SetAttribute("PulseTween", pulseTween)
    else
        local existingTween = statusIndicator:GetAttribute("PulseTween")
        if existingTween then
            existingTween:Cancel()
            statusIndicator:SetAttribute("PulseTween", nil)
        end
        statusIndicator.BackgroundTransparency = 0
    end
end

-- Global functions
_G.MojiHubUpdateStatus = function(status, statusType, description)
    statusType = statusType or "normal"
    description = description or "System running normally"
    
    statusText.Text = status
    statusDesc.Text = description
    
    -- Status colors and animations
    local statusConfig = {
        normal = {color = Color3.fromRGB(0, 255, 100), animate = false},
        opening = {color = Color3.fromRGB(255, 165, 0), animate = true},
        hopping = {color = Color3.fromRGB(255, 80, 80), animate = true},
        collecting = {color = Color3.fromRGB(100, 200, 255), animate = true},
        error = {color = Color3.fromRGB(255, 50, 50), animate = true}
    }
    
    local config = statusConfig[statusType] or statusConfig.normal
    statusIndicator.BackgroundColor3 = config.color
    statusText.TextColor3 = config.color
    
    animateStatusIndicator(config.animate)
end

_G.MojiHubToggle = function()
    if not screenGui or not screenGui.Parent then return end
    
    isVisible = not isVisible
    
    if isVisible then
        -- Show GUI
        local showTween = TweenService:Create(mainFrame,
            TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
            {
                Position = UDim2.new(0.5, -140, 0.15, 0),
                BackgroundTransparency = 0.1
            }
        )
        
        local showShadowTween = TweenService:Create(shadowFrame,
            TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
            {Position = UDim2.new(0.5, -139, 0.15, 1)}
        )
        
        showTween:Play()
        showShadowTween:Play()
        
    else
        -- Hide GUI
        local hideTween = TweenService:Create(mainFrame,
            TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In),
            {
                Position = UDim2.new(0.5, -140, -0.2, 0),
                BackgroundTransparency = 1
            }
        )
        
        local hideShadowTween = TweenService:Create(shadowFrame,
            TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In),
            {Position = UDim2.new(0.5, -139, -0.2, 1)}
        )
        
        hideTween:Play()
        hideShadowTween:Play()
    end
end

_G.MojiHubShow = function()
    if not isVisible then _G.MojiHubToggle() end
end

_G.MojiHubHide = function()
    if isVisible then _G.MojiHubToggle() end
end

_G.MojiHubDestroy = function()
    if screenGui and screenGui.Parent then
        if updateConnection then
            updateConnection:Disconnect()
        end
        
        local destroyTween = TweenService:Create(mainFrame,
            TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In),
            {
                Size = UDim2.new(0, 0, 0, 0),
                BackgroundTransparency = 1
            }
        )
        
        destroyTween:Play()
        destroyTween.Completed:Connect(function()
            screenGui:Destroy()
        end)
    end
end

-- Start update loop
updateConnection = RunService.Heartbeat:Connect(function()
    updateDiamondCount()
end)

-- Smooth entrance animation (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç shadow position)
mainFrame.Position = UDim2.new(0.5, -140, -0.2, 0)
shadowFrame.Position = UDim2.new(0.5, -139, -0.2, 1)
mainFrame.BackgroundTransparency = 1

local entranceTween = TweenService:Create(mainFrame,
    TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
    {
        Position = UDim2.new(0.5, -140, 0.15, 0),
        BackgroundTransparency = 0.1
    }
)

local shadowEntranceTween = TweenService:Create(shadowFrame,
    TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
    {Position = UDim2.new(0.5, -139, 0.15, 1)}
)

entranceTween:Play()
shadowEntranceTween:Play()

print("üíé Moji Hub GUI ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!")
print("üìù ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ:")
print("   _G.MojiHubUpdateStatus(‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞, ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó, ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢)")
print("   _G.MojiHubToggle() - ‡∏™‡∏•‡∏±‡∏ö‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á")
print("   _G.MojiHubShow() - ‡πÅ‡∏™‡∏î‡∏á GUI")
print("   _G.MojiHubHide() - ‡∏ã‡πà‡∏≠‡∏ô GUI")
print("   _G.MojiHubDestroy() - ‡∏•‡∏ö GUI")

-- Initialize
_G.MojiHubUpdateStatus("Ready", "normal", "System initialized")
